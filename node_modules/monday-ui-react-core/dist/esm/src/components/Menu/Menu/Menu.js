import{slicedToArray as e}from"../../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as n}from"react/jsx-runtime";import t from"classnames";import{SIZES as s}from"../../../constants/sizes.js";import o,{forwardRef as i,useRef as u,useState as r,useMemo as l,useCallback as d,useEffect as a,useLayoutEffect as c}from"react";import m from"../../../hooks/useMergeRef.js";import p from"../../../hooks/useClickOutside/index.js";import{backwardCompatibilityForProperties as v}from"../../../helpers/backwardCompatibilityForProperties.js";import f from"./hooks/useSubMenuIndex.js";import I from"./hooks/useOnCloseMenu.js";import M from"./hooks/useCloseMenuOnKeyEvent.js";import b from"./hooks/useMenuKeyboardNavigation.js";import x from"./hooks/useMouseLeave.js";import{useAdjacentSelectableMenuIndex as h}from"./hooks/useAdjacentSelectableMenuIndex.js";import{useFocusWithin as S}from"../../../hooks/useFocusWithin.js";import j from"../../../hooks/usePrevious/index.js";import{withStaticProps as O}from"../../../types/withStaticProps.js";import{getStyle as k}from"../../../helpers/typesciptCssModulesHelper.js";import{getTestId as g}from"../../../tests/testIds.js";import{ComponentDefaultTestId as C}from"../../../tests/constants.js";import{useFocusOnMount as y}from"./hooks/useFocusOnMount.js";import{useMenuId as A}from"./hooks/useMenuId.js";import{generateMenuItemId as E}from"./utils/utils.js";import P from"./Menu.module.scss.js";var B=i((function(s,i){var O=s.id,F=s.className,N=s.classname,D=s.size,L=void 0===D?B.sizes.MEDIUM:D,V=s.tabIndex,z=void 0===V?0:V,R=s.ariaLabel,T=void 0===R?"Menu":R,U=s.ariaDescribedBy,W=s.children,w=s.isVisible,H=void 0===w||w,K=s.onClose,_=s.focusOnMount,q=void 0!==_&&_,G=s.focusItemIndex,J=void 0===G?-1:G,Q=s.focusItemIndexOnMount,X=void 0===Q?-1:Q,Y=s.isSubMenu,Z=void 0!==Y&&Y,$=s.useDocumentEventListeners,ee=void 0!==$&&$,ne=s.shouldScrollMenu,te=void 0!==ne&&ne,se=s["data-testid"],oe=u(null),ie=m(oe,i),ue=A(O),re=u(null),le=v([F,N]),de=r(J),ae=e(de,2),ce=ae[0],me=ae[1],pe=r(!1),ve=e(pe,2),fe=ve[0],Ie=ve[1],Me=l((function(){return o.Children.toArray(W).filter((function(e){return!!e.type.isMenuChild||(console.error("Menu child must be a menuChild item (such as MenuItem, MenuDivider, MenuTitle, etc). This child is not supported: ",e),!1)}))}),[W]),be=d((function(e){var n,t,s;me(e);var i=Me[e],u=o.isValidElement(i)?(null===(n=null==i?void 0:i.props)||void 0===n?void 0:n.id)||"".concat(ue,"-item-").concat(e):void 0;u?null===(t=null==oe?void 0:oe.current)||void 0===t||t.setAttribute("aria-activedescendant",u):null===(s=null==oe?void 0:oe.current)||void 0===s||s.removeAttribute("aria-activedescendant")}),[Me,ue]),xe=d((function(e){be(e),Ie(!1)}),[be]),he=f(),Se=he.setSubMenuIsOpenByIndex,je=he.hasOpenSubMenu,Oe=he.openSubMenuIndex,ke=he.resetOpenSubMenuIndex,ge=I({setActiveItemIndex:xe,setOpenSubMenuIndex:he.setOpenSubMenuIndex,onClose:K});p({ref:oe,callback:function(){return ge()}}),M({hasOpenSubMenu:je,onCloseMenu:ge,ref:oe,onClose:K,isSubMenu:Z,useDocumentEventListeners:ee});var Ce=h({children:Me}),ye=Ce.getNextSelectableIndex,Ae=Ce.getPreviousSelectableIndex;b({hasOpenSubMenu:je,getNextSelectableIndex:ye,getPreviousSelectableIndex:Ae,activeItemIndex:ce,setActiveItemIndex:xe,isVisible:H,ref:oe,useDocumentEventListeners:ee}),x({resetOpenSubMenuIndex:ke,hasOpenSubMenu:je,ref:oe,setActiveItemIndex:xe}),y({focusItemIndexOnMount:X,focusChildOnMount:Me[X],getNextSelectableIndex:ye,updateActiveItemIndex:be,setIsInitialFocusSet:Ie});var Ee=d((function(){Ie(!0)}),[Ie]),Pe=j(je);a((function(){var e;je||ee||ce>-1&&Pe&&(null===(e=null==oe?void 0:oe.current)||void 0===e||e.focus())}),[ce,je,Pe,ee]),c((function(){q&&!ee&&requestAnimationFrame((function(){oe&&oe.current&&oe.current.focus()}))}),[oe,q,ee]);var Be=S({onBlurWithin:function(){ge&&ge()}}).focusWithinProps;return n("ul",Object.assign({onFocus:null==Be?void 0:Be.onFocus,onBlur:null==Be?void 0:Be.onBlur,id:ue,"data-testid":se||g(C.MENU,O),className:t(P.menu,k(P,L),le),ref:ie,tabIndex:z,"aria-label":T,role:"menu","aria-describedby":U,onMouseOver:Ee},{children:Me&&o.Children.map(Me,(function(e,n){return o.isValidElement(e)?o.cloneElement(e,Object.assign(Object.assign({},null==e?void 0:e.props),{activeItemIndex:ce,index:n,setActiveItemIndex:be,menuRef:oe,resetOpenSubMenuIndex:ke,isParentMenuVisible:H,setSubMenuIsOpenByIndex:Se,hasOpenSubMenu:n===Oe,closeMenu:ge,id:E(ue,e,n),useDocumentEventListeners:ee,isInitialSelectedState:fe,shouldScrollMenu:te,getNextSelectableIndex:ye,getPreviousSelectableIndex:Ae,isUnderSubMenu:Z,splitMenuItemIconButtonRef:re})):null}))}))}));Object.assign(B,{isMenu:!0,supportFocusOnMount:!0});var F=O(B,{sizes:s});export{F as default};
//# sourceMappingURL=Menu.js.map
