import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as i,jsxs as t}from"react/jsx-runtime";import r,{forwardRef as n,useRef as s,useState as a,useCallback as d,useMemo as l,useLayoutEffect as g}from"react";import c from"classnames";import{camelCase as p}from"lodash-es";import{isForwardRef as m}from"react-is";import u from"../Dialog/Dialog.js";import h from"../DialogContentContainer/DialogContentContainer.js";import f from"../Tooltip/Tooltip.js";import{backwardCompatibilityForProperties as T}from"../../helpers/backwardCompatibilityForProperties.js";import C from"../../hooks/useMergeRef.js";import{BUTTON_ICON_SIZE as v}from"../Button/ButtonConstants.js";import{withStaticProps as E}from"../../types/withStaticProps.js";import{MenuButtonSize as S,MenuButtonComponentPosition as w}from"./MenuButtonConstants.js";import{HideShowEvent as j}from"../Dialog/consts/dialog-show-hide-event.js";import{NOOP as b}from"../../utils/function-utils.js";import{getStyle as M}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as P,ComponentDefaultTestId as O}from"../../tests/testIds.js";import y from"./MenuButton.module.scss.js";import A from"../Icon/Icons/components/Menu.js";import{AnimationType as N}from"../../constants/dialog.js";var D=[f.hideShowTriggers.MOUSE_ENTER],I=[j.CLICK,j.ENTER],R=[],_={main:8,secondary:0},z=n((function(n,E){var w=n.id,j=n.className,B=n.componentClassName,L=n.openDialogComponentClassName,H=n.children,x=n.component,K=void 0===x?A:x,U=n.componentPosition,k=void 0===U?z.componentPositions.START:U,F=n.size,Y=void 0===F?S.SMALL:F,W=n.open,X=void 0!==W&&W,V=n.onClick,q=void 0===V?b:V,G=n.zIndex,J=void 0===G?null:G,Q=n.ariaLabel,Z=void 0===Q?"Menu":Q,$=n.closeDialogOnContentClick,ee=void 0!==$&&$,oe=n.dialogOffset,ie=void 0===oe?_:oe,te=n.dialogPosition,re=void 0===te?u.positions.BOTTOM_START:te,ne=n.dialogClassName,se=n.dialogPaddingSize,ae=void 0===se?h.sizes.MEDIUM:se,de=n.dialogShowTriggerIgnoreClass,le=n.dialogHideTriggerIgnoreClass,ge=n.onMenuHide,ce=void 0===ge?b:ge,pe=n.onMenuShow,me=void 0===pe?b:pe,ue=n.disabled,he=void 0!==ue&&ue,fe=n.text,Te=n.tooltipContent,Ce=n.tooltipProps,ve=n.disabledReason,Ee=n.tooltipTriggers,Se=void 0===Ee?[z.hideTriggers.MOUSE_LEAVE]:Ee,we=n.tooltipPosition,je=void 0===we?z.dialogPositions.RIGHT:we,be=n.startingEdge,Me=void 0===be?"bottom":be,Pe=n.removeTabCloseTrigger,Oe=void 0!==Pe&&Pe,ye=n.tooltipReferenceClassName,Ae=n.hideWhenReferenceHidden,Ne=void 0!==Ae&&Ae,De=n.dialogContainerSelector,Ie=n.active,Re=n.triggerElement,_e=void 0===Re?"button":Re,ze=n["data-testid"],Be=s(null),Le=C(E,Be),He=a(X),xe=e(He,2),Ke=xe[0],Ue=xe[1],ke=null!=Ie?Ie:Ke,Fe=d((function(e){if(e&&"Escape"===e.key){Ue(!1);var o=Be.current;window.requestAnimationFrame((function(){o.focus()}))}}),[Be,Ue]),Ye=d((function(e,o){Ue(!1),ce();var i=Be.current;window.requestAnimationFrame((function(){i&&o===u.hideShowTriggers.ESCAPE_KEY&&i.focus()}))}),[Ue,ce,Be]),We=d((function(){Ue(!0),me()}),[Ue,me]),Xe=l((function(){var e=new Set([u.hideShowTriggers.CLICK_OUTSIDE,u.hideShowTriggers.TAB_KEY,u.hideShowTriggers.ESCAPE_KEY]);return ee&&(e.add(u.hideShowTriggers.CONTENT_CLICK),e.add(u.hideShowTriggers.ENTER)),Oe&&e.delete(u.hideShowTriggers.TAB_KEY),[r.Children.toArray(H).map((function(o){if(!r.isValidElement(o))return null;var i={};return o.type&&o.type.supportFocusOnMount&&(i.focusOnMount=!0,e.delete(u.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(i.onClose=Fe),r.cloneElement(o,i)})),Array.from(e)]}),[H,Fe,ee,Oe]),Ve=e(Xe,2),qe=Ve[0],Ge=Ve[1],Je=l((function(){return 0===qe.length?null:i(h,Object.assign({size:ae,type:h.types.POPOVER},{children:qe}))}),[qe,ae]),Qe=l((function(){return Object.assign(Object.assign({},_),ie)}),[ie]),Ze=K,$e=l((function(){switch(Y){case S.XXS:case S.XS:return 16;case S.SMALL:case S.MEDIUM:case S.LARGE:return v;default:return 24}}),[Y]),eo=Ze?i(Ze,{size:""+$e,role:"img","aria-hidden":"true"}):null;g((function(){Ue(X)}),[X,Ue]);var oo=T([Te,ve]),io=T([j,B]),to="button"===_e?{ref:Le}:{active:ke,disabled:he,ref:m(_e)?Le:void 0};return i(f,Object.assign({content:oo,position:je,showTrigger:D,hideTrigger:Se,referenceWrapperClassName:ye,hideWhenReferenceHidden:Ne},Ce,{children:i(u,Object.assign({wrapperClassName:ne,position:re,containerSelector:De,startingEdge:Me,animationType:N.EXPAND,content:Je,moveBy:Qe,showTrigger:he?R:I,hideTrigger:Ge,showTriggerIgnoreClass:de,hideTriggerIgnoreClass:le,useDerivedStateFromProps:!0,onDialogDidShow:We,onDialogDidHide:Ye,zIndex:J,isOpen:Ke,hideWhenReferenceHidden:Ne},{children:t(_e,Object.assign({id:w,"data-testid":ze||P(O.MENU_BUTTON,w),type:"button",className:c(y.wrapper,io,M(y,p("size-".concat(Y))),o(o(o(o({},y.active,ke),M(y,L),Ke&&L),y.disabled,he),y.text,fe)),"aria-haspopup":"true","aria-expanded":Ke,"aria-label":!fe&&Z,onMouseUp:function(e){he?e.currentTarget.blur():q(e)},"aria-disabled":he},to,{children:[k===z.componentPositions.START&&eo,fe&&i("span",Object.assign({className:y.innerText},{children:fe})),k===z.componentPositions.END&&eo]}))}))}))})),B=E(z,{sizes:S,paddingSizes:h.sizes,dialogPositions:u.positions,hideTriggers:u.hideShowTriggers,componentPositions:w});export{B as default};
//# sourceMappingURL=MenuButton.js.map
