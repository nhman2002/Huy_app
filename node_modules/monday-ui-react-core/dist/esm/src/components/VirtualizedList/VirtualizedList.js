import{slicedToArray as t}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as i}from"react/jsx-runtime";import r from"classnames";import{forwardRef as e,useState as o,useMemo as n,useRef as l,useCallback as s,useEffect as a}from"react";import{noop as c}from"lodash-es";import{VariableSizeList as u}from"react-window";import f from"react-virtualized-auto-sizer";import m from"../../hooks/usePrevious/index.js";import d from"../../hooks/useThrottledCallback.js";import v from"../../hooks/useMergeRef.js";import{getNormalizedItems as h,getMaxOffset as p,easeInOutQuint as I,getOnItemsRenderedData as g,isLayoutDirectionScrollbarVisible as S}from"../../services/virtualized-service.js";import{getTestId as T}from"../../tests/testIds.js";import{ComponentDefaultTestId as O}from"../../tests/constants.js";import z from"./VirtualizedList.module.scss.js";var b=e((function(e,b){var j=e.className,y=e.id,C=e.items,R=void 0===C?[]:C,w=e.itemRenderer,x=void 0===w?function(t,i,r){return t}:w,F=e.getItemHeight,L=void 0===F?function(t,i){return t.height}:F,V=e.getItemSize,k=void 0===V?null:V,A=e.layout,D=void 0===A?"vertical":A,M=e.onScroll,N=e.overscanCount,U=void 0===N?0:N,_=e.getItemId,q=void 0===_?function(t,i){return t.id}:_,H=e.scrollToId,P=e.scrollDuration,W=void 0===P?200:P,B=e.onScrollToFinished,E=void 0===B?c:B,Z=e.onItemsRendered,G=e.onItemsRenderedThrottleMs,J=void 0===G?200:G,K=e.onSizeUpdate,Q=void 0===K?c:K,X=e.onVerticalScrollbarVisiblityChange,Y=void 0===X?null:X,$=e.onLayoutDirectionScrollbarVisibilityChange,tt=void 0===$?null:$,it=e.virtualListRef,rt=e.scrollableClassName,et=e.role,ot=e.style,nt=e["data-testid"],lt=o(0),st=t(lt,2),at=st[0],ct=st[1],ut=o(0),ft=t(ut,2),mt=ft[0],dt=ft[1],vt="horizontal"!==D,ht=n((function(){return vt?at:mt}),[vt,at,mt]),pt=m(H),It=l(null),gt=l(null),St=l(null),Tt=l(0),Ot=l({initialized:!1,scrollOffsetInitial:0,scrollOffsetFinal:0,animationStartTime:0}),zt=v(b,It),bt=v(it,St),jt=Ot.current;jt.initialized||(jt.initialized=!0,jt.scrollOffsetInitial=0,jt.scrollOffsetFinal=0,jt.animationStartTime=0);var yt=s((function(t,i){var r=(k||L)(t,i);return void 0===r&&console.error("Couldn't get height for item: ",t),r}),[L,k]),Ct=s((function(t,i){var r=q(t,i);return void 0===r&&console.error("Couldn't get id for item: ",t),r}),[q]),Rt=n((function(){return h(R,Ct,yt)}),[R,Ct,yt]),wt=n((function(){return p(ht,Rt)}),[ht,Rt]),xt=s((function(t){var i=t.scrollDirection,r=t.scrollOffset,e=t.scrollUpdateWasRequested;Tt.current=r,e||(jt.scrollOffsetInitial=r),M&&M(i,r,e)}),[M,Tt,jt]),Ft=s((function(){requestAnimationFrame((function(){var t,i=performance.now()-jt.animationStartTime,r=jt.scrollOffsetFinal-jt.scrollOffsetInitial,e=I(Math.min(1,i/W)),o=Math.min(wt,jt.scrollOffsetInitial+r*e);Tt.current=o,null===(t=St.current)||void 0===t||t.scrollTo(o),W>i?Ft():(jt.animationStartTime=void 0,E&&E())}))}),[W,jt,St,wt,E]),Lt=s((function(t){var i=t.offsetTop;jt.animationStartTime?jt.scrollOffsetFinal=i:jt.scrollOffsetInitial!==i?(jt.scrollOffsetFinal=i,jt.animationStartTime=performance.now(),Ft()):E&&E()}),[jt,Ft,E]),Vt=s((function(t){var i=t.index;return x(R[i],i,t.style)}),[R,x]),kt=s((function(t){return yt(R[t],t)}),[R,yt]),At=s((function(t,i){i===at&&t===mt||setTimeout((function(){ct(i),dt(t),Q(t,i)}),0)}),[at,mt,Q]),Dt=d((function(t){if(Z){var i=g(R,Rt,Ct,t.visibleStartIndex,t.visibleStopIndex,ht,Tt.current);Z(i)}}),{wait:J,trailing:!0},[Z,R,Rt,Ct,ht]);return a((function(){if(H&&pt!==H){var t=S(R,Rt,Ct,ht),i=Rt[H];t&&i&&Lt(i)}}),[pt,H,Lt,Rt,R,Ct,ht]),a((function(){St.current&&St.current.resetAfterIndex(0)}),[Rt]),a((function(){var t=tt||Y;if(t){var i=S(R,Rt,Ct,ht);gt.current!==i&&(gt.current=i,t(i))}}),[tt,Y,R,Rt,ht,Ct]),i("div",Object.assign({ref:zt,className:r(z.virtualizedListWrapper,j),id:y,role:et,"data-testid":nt||T(O.VIRTUALIZED_LIST,y),style:ot},{children:i(f,{children:function(t){var r=t.height,e=t.width;return At(e,r),i(u,Object.assign({ref:bt,height:r,width:e,itemCount:R.length,itemSize:kt,onScroll:xt,layout:D,overscanCount:U,onItemsRendered:Dt,className:rt},{children:Vt}))}})}))}));export{b as default};
//# sourceMappingURL=VirtualizedList.js.map
