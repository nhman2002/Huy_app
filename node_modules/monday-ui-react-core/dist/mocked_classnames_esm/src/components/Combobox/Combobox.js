import{slicedToArray as o,defineProperty as e}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsxs as i,jsx as t}from"react/jsx-runtime";import{camelCase as s,noop as r,isFunction as n}from"lodash-es";import a from"classnames";import{forwardRef as l,useRef as d,useState as c,useCallback as m,useMemo as p}from"react";import{getStyle as u}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as b,ComponentDefaultTestId as v}from"../../tests/testIds.js";import f from"../../hooks/useMergeRef.js";import h from"../Search/Search.js";import g from"../Button/Button.js";import C from"../Text/Text.js";import x from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as O}from"./ComboboxService.js";import{ComboboxItems as j}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as y}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as I,useKeyboardNavigation as N}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as S}from"./helpers.js";import{withStaticProps as k}from"../../types/withStaticProps.js";import F from"./Combobox.module.scss.js";import{BASE_SIZES as H}from"../../constants/sizes.js";var L=l((function(l,x){var k=l.className,H=void 0===k?"":k,T=l.optionClassName,M=void 0===T?"":T,R=l.searchWrapperClassName,w=l.searchIcon,z=l.id,A=void 0===z?"":z,B=l.placeholder,V=void 0===B?"":B,W=l.size,D=void 0===W?L.sizes.MEDIUM:W,E=l.defaultVisualFocusFirstIndex,P=l.optionLineHeight,X=void 0===P?32:P,_=l.optionsListHeight,U=l.autoFocus,Y=void 0!==U&&U,q=l.disabled,G=void 0!==q&&q,J=l.options,K=void 0===J?[]:J,Q=l.categories,Z=l.withCategoriesDivider,$=void 0!==Z&&Z,oo=l.noResultsMessage,eo=void 0===oo?"No results found":oo,io=l.onAddNew,to=l.addNewLabel,so=void 0===to?"Add new":to,ro=l.onClick,no=void 0===ro?function(o){}:ro,ao=l.filter,lo=void 0===ao?O:ao,co=l.disableFilter,mo=void 0!==co&&co,po=l.onFilterChanged,uo=l.loading,bo=void 0!==uo&&uo,vo=l.onOptionHover,fo=void 0===vo?r:vo,ho=l.onOptionLeave,go=void 0===ho?r:ho,Co=l.shouldScrollToSelectedItem,xo=void 0===Co||Co,Oo=l.noResultsRenderer,jo=l.stickyCategories,yo=void 0!==jo&&jo,Io=l.optionRenderer,No=void 0===Io?null:Io,So=l.renderOnlyVisibleOptions,ko=void 0!==So&&So,Fo=l.clearFilterOnSelection,Ho=void 0!==Fo&&Fo,Lo=l.maxOptionsWithoutScroll,To=l.defaultFilter,Mo=void 0===To?"":To,Ro=l.searchInputAriaLabel,wo=void 0===Ro?"Search for content":Ro,zo=l["data-testid"],Ao=d(null),Bo=d(null),Vo=f(x,Ao),Wo=c(Mo),Do=o(Wo,2),Eo=Do[0],Po=Do[1],Xo=m((function(o){po&&po(o),Po(o)}),[Po,po]),_o=m((function(o,e,i){fo(o,e,i)}),[fo]),Uo=p((function(){return mo?K:lo(Eo,K)}),[K,Eo,lo,mo]),Yo=c(-1),qo=o(Yo,2),Go=qo[0],Jo=qo[1],Ko=m((function(o){return void 0!==o&&Uo[o]&&!Uo[o].disabled}),[Uo]),Qo=m((function(){io&&io(Eo),Po("")}),[io,Eo,Po]),Zo=Uo.length>0,$o=Eo.length>0;var oe=c(),ee=o(oe,2),ie=ee[0],te=ee[1],se=m((function(o){var e,i;(null===(e=null==o?void 0:o.category)||void 0===e?void 0:e.label)!==ie&&te(null===(i=null==o?void 0:o.category)||void 0===i?void 0:i.label)}),[ie]),re=I({categories:Q,options:Uo,filterValue:Eo,withCategoriesDivider:$,optionLineHeight:X}),ne=re.items,ae=re.itemsMap,le=re.selectableItems,de=m((function(o,e){no(le[e]),Ko(e)&&Jo(e),Ho&&Xo("")}),[no,le,Ko,Ho,Xo]),ce=N({getOptionId:S,defaultVisualFocusFirstIndex:E,onClick:de,isChildSelectable:Ko,options:le,inputRef:Bo}),me=ce.visualFocusItemIndex,pe=ce.visualFocusItemId,ue=ce.onOptionClick;return i(C,Object.assign({type:C.types.TEXT2,ref:Vo,className:a(F.combobox,H,u(F,s("size-"+D)),e(e({},F.empty,!Zo),F.stickyCategory,yo)),id:A,"data-testid":zo||b(v.COMBOBOX,A),ellipsis:!1},{children:[i("div",Object.assign({className:F.comboboxList,style:{maxHeight:_},role:"listbox"},{children:[t(h,{ref:Bo,value:Eo,wrapperClassName:a(F.comboboxSearchWrapper,R),className:F.comboboxSearch,inputAriaLabel:wo,activeDescendant:pe,id:"combobox-search",placeholder:V,size:D,disabled:G,onChange:Xo,autoFocus:Y,loading:bo,iconName:w}),yo&&t(y,{label:ie}),t(j,{stickyCategories:yo,categories:Q,options:ne,itemsMap:ae,optionClassName:M,optionRenderer:No,activeItemIndex:Go,onActiveCategoryChanged:se,onOptionClick:ue,onOptionEnter:_o,onOptionLeave:go,optionLineHeight:X,shouldScrollToSelectedItem:xo,renderOnlyVisibleOptions:ko,maxOptionsWithoutScroll:Lo,visualFocusItemIndex:me})]})),$o&&!Zo&&!bo&&(Oo?Oo():i("div",Object.assign({className:F.comboboxNoResults},{children:[t("div",Object.assign({className:F.comboboxMessageWrapper},{children:t("span",Object.assign({className:F.comboboxMessage},{children:eo}))})),io&&!G&&t(g,Object.assign({className:F.addNewButton,size:D,kind:g.kinds.TERTIARY,onClick:Qo},{children:t("span",Object.assign({className:F.buttonLabel},{children:n(so)?so(Eo):so}))}))]})))]}))})),T=k(L,{sizes:H,iconTypes:x.iconTypes});export{T as default};
//# sourceMappingURL=Combobox.js.map
