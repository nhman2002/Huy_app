import{inherits as e,createSuper as o,createClass as n,classCallCheck as t,assertThisInitialized as i,toConsumableArray as s}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsxs as a,jsx as r}from"react/jsx-runtime";import l from"classnames";import{PureComponent as u}from"react";import{createPortal as d}from"react-dom";import{Manager as h,Reference as c,Popper as p}from"react-popper";import{DialogPosition as g}from"../../constants/positions.js";import{isFunction as m}from"lodash-es";import{backwardCompatibilityForProperties as f}from"../../helpers/backwardCompatibilityForProperties.js";import{NOOP as v,convertToArray as E,chainFunctions as D}from"../../utils/function-utils.js";import{DialogContent as y}from"./DialogContent/DialogContent.js";import{isInsideClass as w}from"../../utils/dom-utils.js";import{Refable as C}from"../Refable/Refable.js";import{HideShowEvent as k,AnimationType as T}from"../../constants/dialog.js";import O from"./Dialog.module.scss.js";import{getTestId as S,ComponentDefaultTestId as b}from"../../tests/testIds.js";var M=function(g){e(D,u);var v=o(D);function D(e){var o;return t(this,D),(o=v.call(this,e)).state={shouldUseDerivedStateFromProps:e.useDerivedStateFromProps,isOpen:e.shouldShowOnMount},o.onMouseEnter=o.onMouseEnter.bind(i(o)),o.onMouseLeave=o.onMouseLeave.bind(i(o)),o.onMouseDown=o.onMouseDown.bind(i(o)),o.onClick=o.onClick.bind(i(o)),o.onFocus=o.onFocus.bind(i(o)),o.onBlur=o.onBlur.bind(i(o)),o.isShown=o.isShown.bind(i(o)),o.onEsc=o.onEsc.bind(i(o)),o.onClickOutside=o.onClickOutside.bind(i(o)),o.onDialogEnter=o.onDialogEnter.bind(i(o)),o.onDialogLeave=o.onDialogLeave.bind(i(o)),o.getContainer=o.getContainer.bind(i(o)),o.onContentClick=o.onContentClick.bind(i(o)),o.onKeyDown=o.onKeyDown.bind(i(o)),o.closeDialogOnEscape=o.closeDialogOnEscape.bind(i(o)),o.onContextMenu=o.onContextMenu.bind(i(o)),o.hideTimeout=null,o.showTimeout=null,o}return n(D,[{key:"closeDialogOnEscape",value:function(e){if(this.state.isOpen)switch(e.key){case"Escape":this.hideDialogIfNeeded(e,k.ESCAPE_KEY);break;case"Tab":this.handleEvent(k.TAB_KEY,e.target,e);break;case"Enter":this.handleEvent(k.ENTER,e.target,e)}}},{key:"componentDidMount",value:function(){var e=this.props,o=e.onDialogDidShow,n=f([e.shouldCallbackOnMount,e.shoudlCallbackOnMount],!1),t=this.state.isOpen;document.addEventListener("keyup",this.closeDialogOnEscape),n&&t&&o&&o()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.closeDialogOnEscape)}},{key:"getContainer",value:function(){var e=this.props.containerSelector;if(!e)return document.body;var o=document.querySelector(e);return o||document.body}},{key:"showDialog",value:function(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.props,t=n.showDelay,i=n.instantShowAndHide,s=n.getDynamicShowDelay,a=t,r=o.preventAnimation;if(s){var l=s();a=l.showDelay||0,r=r||l.preventAnimation}i?(this.onShowDialog(),this.setState({isOpen:!0,preventAnimation:r}),this.showTimeout=null):this.showTimeout=setTimeout((function(){e.onShowDialog(),e.showTimeout=null,e.setState({isOpen:!0,preventAnimation:r})}),a)}},{key:"onShowDialog",value:function(){this.isShown()||(0,this.props.onDialogDidShow)()}},{key:"showDialogIfNeeded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.props.disable;o||(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.showTimeout||this.showDialog(e))}},{key:"hideDialog",value:function(e,o){var n=this,t=this.props,i=t.hideDelay;t.instantShowAndHide?(this.onHideDialog(e,o),this.setState({isOpen:!1}),this.hideTimeout=null):this.hideTimeout=setTimeout((function(){n.onHideDialog(e,o),n.setState({isOpen:!1}),n.hideTimeout=null}),i)}},{key:"onHideDialog",value:function(e,o){var n=this.props.onDialogDidHide;n&&n(e,o)}},{key:"hideDialogIfNeeded",value:function(e,o){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout||this.hideDialog(e,o)}},{key:"handleEvent",value:function(e,o,n){var t=this.props,i=t.showTriggerIgnoreClass,s=t.hideTriggerIgnoreClass;return!this.isShowTrigger(e)||this.isShown()||w(o,i)?this.isHideTrigger(e)&&!w(o,s)?this.hideDialogIfNeeded(n,e):void 0:this.showDialogIfNeeded()}},{key:"isShown",value:function(){return this.state.isOpen||this.props.open}},{key:"isShowTrigger",value:function(e){var o=this.props,n=o.addKeyboardHideShowTriggersByDefault,t=E(o.showTrigger);return!(!n||e!==k.FOCUS||-1>=t.indexOf(k.MOUSE_ENTER))||t.indexOf(e)>-1}},{key:"isHideTrigger",value:function(e){var o=this.props,n=o.addKeyboardHideShowTriggersByDefault,t=E(o.hideTrigger);return!(!n||e!==k.BLUR||-1>=t.indexOf(k.MOUSE_LEAVE))||t.indexOf(e)>-1}},{key:"onMouseEnter",value:function(e){this.handleEvent(k.MOUSE_ENTER,e.target,e)}},{key:"onMouseLeave",value:function(e){this.handleEvent(k.MOUSE_LEAVE,e.target,e)}},{key:"onClick",value:function(e){e.button||this.handleEvent(k.CLICK,e.target,e)}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.handleEvent(k.ENTER,e.target,e),"Tab"===e.key&&this.handleEvent(k.TAB_KEY,e.target,e)}},{key:"onMouseDown",value:function(e){e.button||this.handleEvent(k.MOUSE_DOWN,e.target,e)}},{key:"onFocus",value:function(e){this.handleEvent(k.FOCUS,e.target,e)}},{key:"onBlur",value:function(e){this.handleEvent(k.BLUR,e.relatedTarget,e)}},{key:"onEsc",value:function(e){this.handleEvent(k.ESCAPE_KEY,e.target,e)}},{key:"onContextMenu",value:function(e){this.handleEvent(k.CONTEXT_MENU,e.target,e)}},{key:"onClickOutside",value:function(e){var o=this.props.onClickOutside;this.handleEvent(k.CLICK_OUTSIDE,e.target,e),o(e)}},{key:"onDialogEnter",value:function(){this.props.showOnDialogEnter&&this.showDialogIfNeeded()}},{key:"onDialogLeave",value:function(e){this.props.showOnDialogEnter&&this.hideDialogIfNeeded(e,"DialogLeave")}},{key:"onContentClick",value:function(e){var o=this.props.onContentClick;this.handleEvent(k.CONTENT_CLICK,e.target,e),o(e)}},{key:"render",value:function(){var e=this,o=this.props,n=o.wrapperClassName,t=o.content,i=o.startingEdge,u=o.children,g=o.preventAnimationOnMount,f=o.animationType,v=o.position,E=o.showDelay,D=o.moveBy,w=o.modifiers,T=o.tooltip,M=o.tooltipClassName,L=o.referenceWrapperClassName,H=o.zIndex,I=o.hideWhenReferenceHidden,A=o.disableContainerScroll,U=o.containerSelector,_=this.state.preventAnimation,K=o["data-testid"]||S(b.DIALOG,o.id),j=!this.isHideTrigger(k.CLICK_OUTSIDE),B=g||_?void 0:f,R=m(t)?t():t;return R?a(h,{children:[r(c,{children:function(o){var n=o.ref;return r(C,Object.assign({className:l(L),ref:n,onBlur:N("onBlur",e,e.props),onKeyDown:N("onKeyDown",e,e.props),onClick:N("onClick",e,e.props),onFocus:N("onFocus",e,e.props),onMouseDown:N("onMouseDown",e,e.props),onMouseEnter:N("onMouseEnter",e,e.props),onMouseLeave:N("onMouseLeave",e,e.props)},{children:u}))}}),d(r(p,Object.assign({placement:v,modifiers:[{name:"offset",options:{offset:[D.secondary,D.main]}},{name:"zIndex",enabled:!0,phase:"write",fn:function(e){var o=e.state;return H&&(o.styles.popper.zIndex=H+""),o}},{name:"rotator",enabled:!0,phase:"write",fn:function(e){var o=e.state;return o.styles.arrow?(o.styles.arrow.transform="".concat(o.styles.arrow.transform," rotate(45deg)"),o):o}}].concat(s(w))},{children:function(o){var t=o.placement,s=o.style,u=o.ref,d=o.arrowProps,h=o.isReferenceHidden;if(!e.isShown()&&t)return null;if(I&&h){var c=new CustomEvent("onReferenceHidden");e.hideDialog(c,"onReferenceHidden")}return a(y,Object.assign({"data-testid":K,isReferenceHidden:I&&h,onMouseEnter:e.onDialogEnter,onMouseLeave:e.onDialogLeave,disableOnClickOutside:j,onClickOutside:e.onClickOutside,onContextMenu:e.onContextMenu,onEsc:e.onEsc,animationType:B,position:t,wrapperClassName:n,startingEdge:i,isOpen:e.isShown(),showDelay:E,styleObject:s,ref:u,onClick:e.onContentClick,hasTooltip:!!T,containerSelector:U,disableContainerScroll:A},{children:[R,T&&r("div",{style:d.style,ref:d.ref,className:l(O.arrow,M),"data-placement":t})]}))}})),this.getContainer())]}):u}}],[{key:"getDerivedStateFromProps",value:function(e,o){return o.shouldUseDerivedStateFromProps?{isOpen:e.isOpen}:null}}]),D}();function N(e,o,n){return D([n[e],o[e]],!0)}M.hideShowTriggers=k,M.positions=g,M.animationTypes=T,M.defaultProps={position:"top",modifiers:[],moveBy:{main:0,secondary:0},showDelay:100,hideDelay:100,showTrigger:M.hideShowTriggers.MOUSE_ENTER,hideTrigger:M.hideShowTriggers.MOUSE_LEAVE,showOnDialogEnter:!1,shouldShowOnMount:!1,disable:!1,open:!1,animationType:M.animationTypes.EXPAND,preventAnimationOnMount:!1,containerSelector:"body",tooltip:!1,onDialogDidShow:v,onDialogDidHide:v,onClickOutside:v,onContentClick:v,useDerivedStateFromProps:!1,hideWhenReferenceHidden:!1,shoudlCallbackOnMount:!1,shouldCallbackOnMount:!1,instantShowAndHide:!1,addKeyboardHideShowTriggersByDefault:!1};export{M as default};
//# sourceMappingURL=Dialog.js.map
