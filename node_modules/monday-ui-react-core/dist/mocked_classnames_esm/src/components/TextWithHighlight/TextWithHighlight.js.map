{"version":3,"file":"TextWithHighlight.js","sources":["../../../../../src/components/TextWithHighlight/TextWithHighlight.tsx"],"sourcesContent":["import { ComponentDefaultTestId, getTestId } from \"../../tests/test-ids-utils\";\nimport cx from \"classnames\";\nimport React, { forwardRef, useLayoutEffect, useMemo, useRef } from \"react\";\nimport Tooltip from \"../../components/Tooltip/Tooltip\";\nimport useIsOverflowing from \"../../hooks/useIsOverflowing/useIsOverflowing\";\nimport useMergeRef from \"../../hooks/useMergeRef\";\nimport VibeComponentProps from \"../../types/VibeComponentProps\";\nimport { DialogPosition } from \"../../constants\";\nimport styles from \"./TextWithHighlight.module.scss\";\n\nconst getTextPart = (\n  text: string,\n  key: number,\n  shouldHighlight: boolean,\n  wrappingTextTag: keyof JSX.IntrinsicElements = \"em\",\n  wrappingElementClassName: string\n) => {\n  const WrappingElement = wrappingTextTag;\n  if (shouldHighlight) {\n    return (\n      <WrappingElement className={cx(styles.highlightText, wrappingElementClassName)} key={key}>\n        {text}\n      </WrappingElement>\n    );\n  }\n  return <span key={key}>{text}</span>;\n};\n\nexport interface TextWithHighlightProps extends VibeComponentProps {\n  /** Text to wrap */\n  text?: string;\n  highlightTerm?: string;\n  /** Number of highlighted parts */\n  limit?: number;\n  ignoreCase?: boolean;\n  /** Should use ellipsis */\n  useEllipsis?: boolean;\n  /** Allow highlight every word as a separate term */\n  allowTermSplit?: boolean;\n  linesToClamp?: number;\n  /** Tooltip to show when there is no overflow */\n  nonEllipsisTooltip?: string;\n  /** HTML tag to wrap the selected text */\n  wrappingTextTag?: keyof JSX.IntrinsicElements;\n  wrappingElementClassName?: string;\n  tooltipPosition?: DialogPosition;\n}\n\nconst TextWithHighlight: React.FC<TextWithHighlightProps> = forwardRef(\n  (\n    {\n      className,\n      id,\n      text = \"\",\n      highlightTerm,\n      limit,\n      useEllipsis = true,\n      linesToClamp = 3,\n      ignoreCase = true,\n      allowTermSplit = true,\n      nonEllipsisTooltip,\n      tooltipPosition,\n      wrappingTextTag = \"em\",\n      wrappingElementClassName,\n      \"data-testid\": dataTestId\n    },\n    ref\n  ) => {\n    const componentRef = useRef(null);\n    const mergedRef = useMergeRef(ref, componentRef);\n\n    const textWithHighlights = useMemo(() => {\n      if (!text || !highlightTerm || limit === 0) return text;\n      let finalTerm = highlightTerm;\n      if (allowTermSplit) {\n        finalTerm = highlightTerm.split(\" \").join(\"|\");\n      }\n      const tokens = text.split(new RegExp(`(${finalTerm})`, ignoreCase ? \"i\" : \"\"));\n      const parts = [];\n      // Tokens include the term search (in odd indices)\n      let highlightTermsCount = 0;\n      let key = 0;\n      for (let i = 0; i < tokens.length; i++) {\n        // skip empty tokens\n        if (tokens[i]) {\n          // adding highlight part\n          const isTermPart = i % 2 === 1;\n          const shouldHighlight = isTermPart && (!limit || limit < 0 || highlightTermsCount < limit);\n          parts.push(getTextPart(tokens[i], key++, shouldHighlight, wrappingTextTag, wrappingElementClassName));\n          if (isTermPart) highlightTermsCount++;\n        }\n      }\n\n      return parts;\n    }, [text, highlightTerm, limit, ignoreCase, allowTermSplit, wrappingTextTag, wrappingElementClassName]);\n\n    const isOverflowing = useIsOverflowing({ ref: useEllipsis && componentRef });\n\n    useLayoutEffect(() => {\n      if (componentRef.current) {\n        componentRef.current.style.setProperty(\"--heading-clamp-lines\", linesToClamp.toString());\n      }\n    }, [componentRef, linesToClamp]);\n\n    const Element = (\n      <div\n        ref={mergedRef}\n        className={cx(styles.textWithHighlightWrapper, className, {\n          [styles.withEllipsis]: useEllipsis\n        })}\n        id={id}\n        data-testid={dataTestId || getTestId(ComponentDefaultTestId.TEXT_WITH_HIGHLIGHT, id)}\n      >\n        {textWithHighlights}\n      </div>\n    );\n\n    if (isOverflowing || nonEllipsisTooltip) {\n      const tooltipContent = isOverflowing ? text : nonEllipsisTooltip;\n      return (\n        <Tooltip content={tooltipContent} position={tooltipPosition}>\n          {Element}\n        </Tooltip>\n      );\n    }\n    return Element;\n  }\n);\n\nexport default TextWithHighlight;\n"],"names":["getTextPart","text","key","shouldHighlight","wrappingTextTag","arguments","length","undefined","wrappingElementClassName","WrappingElement","_jsx","Object","assign","className","cx","styles","highlightText","children","TextWithHighlight$1","forwardRef","_ref","ref","id","_ref$text","highlightTerm","limit","_ref$useEllipsis","useEllipsis","_ref$linesToClamp","linesToClamp","_ref$ignoreCase","ignoreCase","_ref$allowTermSplit","allowTermSplit","nonEllipsisTooltip","tooltipPosition","_ref$wrappingTextTag","dataTestId","componentRef","useRef","mergedRef","useMergeRef","textWithHighlights","useMemo","finalTerm","split","join","tokens","RegExp","concat","parts","highlightTermsCount","i","isTermPart","push","isOverflowing","useIsOverflowing","useLayoutEffect","current","style","setProperty","Element","textWithHighlightWrapper","_defineProperty","withEllipsis","getTestId","ComponentDefaultTestId","TEXT_WITH_HIGHLIGHT","Tooltip","content","position"],"mappings":"mfAUA,IAAMA,EAAc,SAClBC,EACAC,EACAC,GAGE,IAFFC,EAA+CC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAA,KAC/CG,EAAgCH,UAAAC,OAAAD,EAAAA,kBAAAE,EAE1BE,EAAkBL,EACxB,OAAID,EAEAO,EAACD,EAAeE,OAAAC,OAAA,CAACC,UAAWC,EAAGC,EAAOC,cAAeR,IAClD,CAAAS,SAAAhB,IADkFC,GAKlFQ,EAAiB,OAAA,CAAAO,SAAAhB,GAANC,EACpB,EAuGAgB,EAjF4DC,GAC1D,SAAAC,EAiBEC,GACE,IAhBAR,EAASO,EAATP,UACAS,EAAEF,EAAFE,GAAEC,EAAAH,EACFnB,KAAAA,OAAO,IAAHsB,EAAG,GAAEA,EACTC,EAAaJ,EAAbI,cACAC,EAAKL,EAALK,MAAKC,EAAAN,EACLO,YAAAA,OAAc,IAAHD,GAAOA,EAAAE,EAAAR,EAClBS,aAAAA,OAAe,IAAHD,EAAG,EAACA,EAAAE,EAAAV,EAChBW,WAAAA,OAAa,IAAHD,GAAOA,EAAAE,EAAAZ,EACjBa,eAAAA,OAAiB,IAAHD,GAAOA,EACrBE,EAAkBd,EAAlBc,mBACAC,EAAef,EAAfe,gBAAeC,EAAAhB,EACfhB,gBAAAA,OAAkB,IAAHgC,EAAG,KAAIA,EACtB5B,EAAwBY,EAAxBZ,yBACe6B,EAAUjB,EAAzB,eAIIkB,EAAeC,EAAO,MACtBC,EAAYC,EAAYpB,EAAKiB,GAE7BI,EAAqBC,GAAQ,WACjC,IAAK1C,IAASuB,GAA2B,IAAVC,EAAa,OAAOxB,EACnD,IAAI2C,EAAYpB,EACZS,IACFW,EAAYpB,EAAcqB,MAAM,KAAKC,KAAK,MAO5C,IALA,IAAMC,EAAS9C,EAAK4C,MAAUG,OAAM,IAAAC,OAAKL,OAAcb,EAAa,IAAM,KACpEmB,EAAQ,GAEVC,EAAsB,EACtBjD,EAAM,EACDkD,EAAI,EAAOL,EAAOzC,OAAX8C,EAAmBA,IAEjC,GAAIL,EAAOK,GAAI,CAEb,IAAMC,EAAaD,EAAI,GAAM,EAE7BF,EAAMI,KAAKtD,EAAY+C,EAAOK,GAAIlD,IADVmD,KAAgB5B,GAAiB,EAARA,GAAmCA,EAAtB0B,GACJ/C,EAAiBI,IACvE6C,GAAYF,GACjB,CAGH,OAAOD,CACT,GAAG,CAACjD,EAAMuB,EAAeC,EAAOM,EAAYE,EAAgB7B,EAAiBI,IAEvE+C,EAAgBC,EAAiB,CAAEnC,IAAKM,GAAeW,IAE7DmB,GAAgB,WACVnB,EAAaoB,SACfpB,EAAaoB,QAAQC,MAAMC,YAAY,wBAAyB/B,KAEpE,GAAG,CAACS,EAAcT,IAElB,IAAMgC,EACJnD,EACE,MAAAC,OAAAC,OAAA,CAAAS,IAAKmB,EACL3B,UAAWC,EAAGC,EAAO+C,yBAA0BjD,EAASkD,KACrDhD,EAAOiD,aAAerC,IAEzBL,GAAIA,EACS,cAAAe,GAAc4B,EAAUC,EAAuBC,oBAAqB7C,cAEhFoB,KAIL,OAAIa,GAAiBrB,EAGjBxB,EAAC0D,EAAOzD,OAAAC,OAAA,CAACyD,QAFYd,EAAgBtD,EAAOiC,EAEVoC,SAAUnC,GAAe,CAAAlB,SACxD4C,KAIAA,CACT"}